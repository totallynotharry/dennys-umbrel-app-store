version: "3.7"

services:
  app_proxy:
    environment:
      APP_HOST: denny-pastefy_app_1
      APP_PORT: 80

  app:
    image: interaapps/pastefy:latest
    environment:
      HTTP_SERVER_PORT: 80
      HTTP_SERVER_CORS: "*"
      DATABASE_DRIVER: mysql
      DATABASE_NAME: pastefy
      DATABASE_USER: pastefy
      DATABASE_PASSWORD: pastefy
      DATABASE_HOST: db
      DATABASE_PORT: 3336
      SERVER_NAME: "http://umbrel-local:9999"
      OAUTH2_PROVIDER_CLIENT_ID: 
      OAUTH2_PROVIDER_CLIENT_SECRET: 
    restart: on-failure
    depends_on:
      - db

  db:
    image: linuxserver/mariadb:11.4.4@sha256:fdf30e6b302688c290cef10ca24b80e6e25e93955bc6b64636777f06676a6c52
    environment:
      MYSQL_ROOT_PASSWORD: pastefy
      MYSQL_DATABASE: pastefy
      MYSQL_USER: pastefy
      MYSQL_PASSWORD: pastefy
    ports:
      - 3136:3336
    volumes:
      - ${APP_DATA_DIR}/data/dbvol:/var/lib/mysql
    restart: on-failure

volumes:
  dbvol:
